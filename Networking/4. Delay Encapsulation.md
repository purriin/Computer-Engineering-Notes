- How do packet loss and delay occur?
	- Packets *queue* in router buffers
		- Packets queue, wait for turn
		- Arrival rate to link (temporarily) exceeds output link capacity: packet loss
**Queuing Delay**: Suffering in the queue waiting for your turn
**Transmission Delay**: Time it takes for the packet to arrive at destination
## 4.1 Packet Delay: Four Sources
$$
d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}
$$
1. $d_{proc}$ : nodal processing, time it takes to process and make a decision on where to send
	- Check bit errors, check integrity and that there is no loss
	- Determine output link
	- Typically $\lt$ msec
2. $d_{queue}$ : queuing delay, time spent waiting in queue
	- Time waiting at output link for transmission
	- Depends on congestion level of router
3. $d_{trans}$ : transmission delay, time it takes for bits to arrive
	- $L$: packet length (bits)
	- $R$: link transmission rate (bps)
	- $d_{trans} = \frac{L}{R}$
4. $d_{prop}$ : propagation delay, time it takes for energy to travel
	- $d$: length of physical link
	- $s$: propagation speed $(~2\times10^8 m/sec)$
	- $d_{proc} = \frac{d}{s}$

## 4.2 Packet Queuing Delay
- $R$: link bandwidth (bps)
- $L$: packet length (bits)
- $a$: average packet arrival rate
- Traffic intensity $\rho = \frac{La}{R}$
	- $\rho \approx 0$: avg. queuing delay small
	- $\rho \rightarrow 1$: avg. queuing delay large
	- $p \gt 1$: "work" arriving is more than can be serviced - average delay infinite!
## 4.3 "Real" Internet Delays and Routes
- What do "real" Internet delay & loss look like?
- **Traceroute** Program: Provided delay measurement from source to router along end-end Internet path towards destination. For all $i$:
	- Sends 3 packets that will reach router $i$ on path towards destination (with time-to-live field value of $i$)
	- Router $i$ will return packets to sender
	- Sender measures time interval between transmission and reply
## 4.4 Packet Loss
- Queue (aka buffer) preceding link in buffer has finite capacity
- Packet arriving to full queue dropped (aka lost)
- Lost packet may be transmitted by previous node, by source end system, or not at all

### 4.4.1 Example
- A is an HTTP client, B is a web server (more in next chapter). A sends a GET packet to receive a file of size 1000 bytes and the GET packet is 50 bytes. The transmission rate of the links is 8 Kbit/sec. The router has a random processing/queuing delay uniformly distributed in the interval \[0, 200msec]. Router uses S&F. Find the minimum and maximum delays to fetch the file. What is the average delay? Ignore the propagation delay.
	- Ans:
		- Minimum: 0.1  
		- Maximum: 
		- Average:

## 4.5 Throughput
**Throughput**: Rate (bits/time unit) at which bits are being sent from sender to receiver
- Instantaneous: Rate at given point in time
- Average: Rate over longer period of time

**Bottleneck Link**: Link on end-end path that constrains end-end throughput
- The minimum of the 2 dictates the 

## 4.5.1 Example
1. In which model packets are more likely to be lost in the network:
	- Ans: $R_s \gt R_c$
	- Buffer at $R_s$ will fill up in the other model since it will take a while for $R_c$ a while
2. What are the desired characteristics of model $R_s \lt R_c$:

### 4.5.2 Network Scenario
- Per-connection end-end throughput: $min(R_c,R_s, \frac{R}{10})$
- In practice: $R_c$ or $R_s$ is often bottleneck

## 4.6 Protocol "Layers" and Reference Models
- Networks are complex with many pieces
	- hosts
	- routers
	- links of various media
	- application
	- protocols
	- hardware, software
- Organize tasks into layers

**Why Layering?**
- Dealing with complex systems:
	- Explicit structure allows identification, relationship of complex system's pieces
		- Layered *reference model* for discussion
- Modularization eases maintenance updating of system
	- Changing in layer's service *implementation*: transparent to rest of system
	- Ex. change in gate procedure doesn't affect rest of system

## 4.7 Internet Protocol Stack
- **Application**: Supporting network applications
	- IMAP, SMTP, HTTP
- **Transport**: Process-process data transfer
	- TCP, UDP
- **Network**: Routing of datagrams from source to destination
	- IP, routing protocols
- **Link**: Data transfer between neighbouring network elements
	- Ethernet, 802,11 (Wi-Fi), PPP
- **Physical**: bits "on the wire"

### 4.7.1 ISO/OSI Reference Model
- Two layers not found in Internet protocol stack

- **Presentation**: Allow applications to interpret meaning of data. Ex. Encryption, compression, machine-specific conventions
- **Session**: Synchronization, checkpointing, recovery of data exchange

- Internet stack "missing" these layers
	- These services *if needed* must be implemented in application

- When you move down the layers you add on extra bits to the message (a header) for each layer and when you move up a layer you remove some bits (a header)
