- Point-to-point: 1 sender 1 receiver
- Reliable, in-order *byte* stream: no "message boundaries"
- Full duplex data:
	- Bi-directional data flow in same connection
	- MSS: Maximum segment size
- Cumulative ACKs
- Pipelining: TCP congestion and flow control set window size
- Connection-Oriented: Handshaking (exchange of control messages) initializes sender, receiver state before data exchange
- Flow Controlled: Sender will not overwhelm receiver

## 15.1 TCP Segment Structure

## 15.2 TCP Sequence Numbers, ACKs
**Sequence Numbers**: Byte stream "number" of first byte in segment's data

**Acknowledgements**: Sequence number of next byte expected from other side. Cumulative ACK

- Q: How receiver handles out-of-order segments
	- Ans: TCP spec doesn't say, up to implementor 
## 15.3 TCP Round Trip Time, Timeout
- Q: How to set TCP timeout value?
	- Longer than RTT but RTT varies
	- Too short: premature timeout, unnecessary retransmissions
	- Too long: Slow reaction to segment loss
- Q: How to estimate RTT?
	- `SampleRTT`: Measured time from segment transmission until ACK receipt
		- Will vary, want estimated RTT "smoother"
		- Average several *recent* measurements not just current `SampleRTT`

$EstimatedRTT = (1 - \alpha)*EstimatedRTT + \alpha*SampleRTT$
- Exponential weighted moving average (EWMA)
- Influence of past sample decreases exponentially fast
- Typical value: $\alpha$ = 0.125

- Timeout interval: `EstimatedRTT` plus "safety margin"
	- Large variation in `EstimatedRTT`: Want a larger safety margin
	- `TimeoutInterval = EstimatedRTT + 4*DevRTT`
- `DevRTT`: EWMA of `SampleRTT` deviation from `EstimatedRTT`
$DevRTT = (1 - \beta)*DevRTT + \beta*|SampleRTT - EstimatedRTT|$
## 15.4 TCP Reliable Data Transfer
- TCP creates reliable service on top of IP's unreliable service
- Pipelined segments
- Cumulative ACKs
- TCP uses single retransmission timer
- Retransmissions are triggered by:
	- Timeout events
	- Duplicate ACKs
- Q: Which one is more severe, timeout of duplicate ACKs?
	- Ans: Timeout since it takes the longestv

## 15.5 TCP Sender Simplified
Event: Data received from application
- Create segment with sequence number
- Sequence number is byte-stream number of first data byte in segment
- Start timer if not already running
	- Think of timer as for the oldest unACKed segment
	- Expiration interval: `TimeOutInterval`

Event: Timeout
- Retransmission segment that caused timeout
- Restart timer

Event: ACK received
- If ACK acknowledged previously unACKed segments
	- Update what is known to be ACKed
	- Start timer if there are still unACKed segments

## 15.6 TCP Fact Retransmit
**TCP Fast Retransmit**: If sender receives 3 additional ACKs for same data ("triple duplicate ACKs"), resend unACKed segment with smallest segment number
- Likely that unAcked segment lost so don't wait for timeout