**IP Address Problems**
- In the 1990s, 2 problems became apparent
	- IP addresses were being exhausted
	- IP routing tables were growing very large

**IP Address Exhaustion**
- Class A, B and C address structure inefficient
	- Class B is too large for most organization but future proof
	- Class C is too small
	- Rate of Class B allocation implied exhaustion by 1994

**IP Routing Table Size**
- Growth in the number of networks in the Internet is reflected in the number of table entries
	- From 1991 to 1995 routing tables doubled in size every 10 months
	- Stress on router processing power and memory allocation

**Solutions**
- Short term solution:
	- Classless Interdomain Routing (CIDR)
	- Private IP Addresses set aside for intranets
- Long term solution:
	- IPv6 with a much bigger address space

## 21.1 New Address Allocation Policy
- Class A and B assigned only for clearly demonstrated need
- Consecutive blocks of class C assigned (up to 64 blocks)
	- All IP addresses in the range have a common prefix and every address with that prefix is within the range
	- Arbitrary prefix length for network ID improves efficiency

| Address Requirement | Address Allocation |
| ------------------- | ------------------ |
| < 256               | 1 Class C          |
| 256 < N < 512       | 2 Class C          |
| 512 < N < 1024      | 4 Class C          |
| 1025 < N < 2048     | 8 Class C          |
| 2048 < N < 4096     | 16 Class C         |
| 4096 < N < 8192     | 32 Class C         |
| 8192 < N < 16384    | 64 Class C         |

## 21.2 Supernetting
- Summarize a contiguous group of Class C addresses using a variable length mask
- Example: 214.158.16.0/20  
	- IP Address (214.158.16.0) & mask length (20)
- IP add = 11010110 10011110 00010000 00000000
- Mask = 11111111 11111111 11110000 00000000
- Contains 16 Class C blocks:
- From 11010110 10011110 00010000 00000000  
	- i.e. 214.158.16.0
- Up to 11010110 10011110 00011111 00000000
	- i.e. 214.158.31.0

## 21.3 Classless Inter-Domain Routing
- CIDR deals with Routing Table Explosion Problem
	- Networks represented by prefix and mask
	- Pre-CIDR: Network with range of 16 contiguous class C blocks requires 16 entries
	- Post-CIDR: Network with range of 16 contiguous class C blocks requires 1 entry

**CIDR**: Classless Inter-Domain Routing (pronounced cider)
- Subnet portion of address of arbitrary length
- Address format: a.b.c.d/x, where x is the number of bits in subnet portion of address

**Routing with CIDR**
- Route according to prefix of address not class
	- Routing table entry has <IP address, network mask>
	- Example: 192.32.136.0/21 the same as <192.32.136.0, 256.256.248.0>

**CIDR Allocation Principles**
- IP address assignment reflects physical topology of network
- Network topology follows continental/national boundaries
	- IP addresses should be assigned on this basis

**IP Addresses: How to get one?**
- That's actually 2 questions:
	1. How does a host get IP address within its network (host part of address)
	2. How does a network get IP address for itself (network part of address)
- Hard-coded by sysadmin in config file (e.g., /etc/rc.config in UNIX)
- DHCP: Dynamic Host Configuration Protocol: dynamically get address from as server
	- Plug and play

## 21.4 Dynamic Host Configuration Protocol
**Goal**: Host dynamically obtains IP address from network server when it joins network
- Can renew its lease on address in use
- Allows reuse of addresses (only hold address while connected/on)
- Support for mobile users who join/leave network

**DHCP Overview**:
- Host broadcasts DHCP discover message \[optional]
- DHCP server responds with DHCP offer message \[optional]
- Host requests IP address: DHCP request message
- DHCP server sends address: DHCP ack message
- DHCP more than IP addresses
- DHCP can return more than just allocated IP address on subnet
	- Address of first hop router for client
	- Name and IP address of DNS server
	- Network mask (indicating network versus host portion of address)

**DHCP Example**
- Connecting laptop will use DHCP to get IP address, address of first-hop router, address of DNS server. router with DHCP server built into router  
- DHCP REQUEST message encapsulated in UDP, encapsulated in IP, encapsulated in Ethernet  
- Ethernet frame broadcast (dest: FFFFFFFFFFFF ) on LAN, received at router running DHCP server  
- Ethernet demux’ed to IP demux’ed, UDP demux’ed to DHCP
- DCP server formulates DHCP ACK containing client’s IP address, IP address of first-hop router for client, name & IP address of DNS server  
- encapsulated DHCP server reply forwarded to client, demuxing up to DHCP at client  
- client now knows its IP address, name and IP address of DNS server, IP address of its first-hop router

-   How does network get subnet part of IP address?  
	- Gets allocated portion of its provider ISP’s address space
	- ISP can then allocate out its address space in 8 blocks

**Hierarchical addressing: route aggregation**
- hierarchical addressing allows efficient advertisement of routing information

Q: how does an ISP get block of addresses?  
A: ICANN: Internet Corporation for Assigned Names and Numbers 
- allocates IP addresses, through 5 regional registries (RRs) (who may then allocate to local registries)  
- manages DNS root zone, including delegation of individual TLD (.com, .edu , ...) management  
Q: are there enough 32-bit IP addresses?  
- ICANN allocated last chunk of IPv4 addresses to RRs in 2011  
- NAT (next) helps IPv4 address space exhaustion  
- IPv6 has 128-bit address space  